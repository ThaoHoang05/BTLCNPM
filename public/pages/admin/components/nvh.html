<div class="manager-layout">
    <div class="content">
        
        <div class="section-header">
            <h2><i class="fas fa-tasks"></i> Quản lý Đăng ký Sử dụng</h2>
            <div class="filter-toolbar">
                <div class="search-group">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="keyword" class="form-control" placeholder="Tìm theo tên, SĐT hoặc mã đơn...">
                </div>

                <div class="filter-group">
                    <span class="filter-label">Từ:</span>
                    <input type="date" id="fromDate" class="form-control date-input">
                    
                    <span class="filter-label">Đến:</span>
                    <input type="date" id="toDate" class="form-control date-input">
                </div>

                <div class="action-group">
                    <button class="btn-refresh" onclick="filterByRange()">
                        <i class="fas fa-filter"></i> Lọc dữ liệu
                    </button>
                </div>
            </div>
            <div class="tabs-header">
                <button class="tab-btn active" onclick="filterRequests('pending')">
                    Chờ duyệt <span class="badge-count" id="countPending">0</span>
                </button>
                <button class="tab-btn" onclick="filterRequests('history')">
                    Lịch sử xử lý
                </button>
            </div>
        </div>

        <div class="table-container">
            <table class="approval-table">
                <thead>
                    <tr>
                        <th width="5%">ID</th>
                        <th width="20%">Người đăng ký</th>
                        <th width="15%">Thời gian thuê</th>
                        <th width="10%">Loại hình</th>
                        <th width="30%">Nội dung / Lý do</th>
                        <th width="20%" class="text-center">Thao tác</th>
                    </tr>
                </thead>
                <tbody id="requestTableBody">
                    </tbody>
            </table>
        </div>
        <div class="pagination-wrapper">
            <div class="pagination-info">
                Hiển thị <strong>1-10</strong> trên tổng số <strong>50</strong> đơn
            </div>
        
            <ul class="pagination-controls">
                <li>
                    <button class="page-btn disabled" title="Trang trước">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </li>
        
                <li><button class="page-btn active">1</button></li>
                <li><button class="page-btn">2</button></li>
                <li><button class="page-btn">3</button></li>
                
                <li><span class="page-dots">...</span></li>
                
                <li><button class="page-btn">12</button></li>
        
                <li>
                    <button class="page-btn" title="Trang sau">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</div>

<div id="detailModal" class="modal-overlay">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h3><i class="fas fa-info-circle"></i> Chi tiết Đơn đăng ký #<span id="detailId"></span></h3>
            <span class="close-btn" onclick="closeModal('detailModal')">&times;</span>
        </div>
        <div class="modal-body">
            <div class="detail-grid">
                <div class="detail-item">
                    <label>Họ và tên:</label>
                    <span id="detailName" class="value-text"></span>
                </div>
                <div class="detail-item">
                    <label>CCCD:</label>
                    <span id="detailCCCD" class="value-text"></span>
                </div>
                <div class="detail-item">
                    <label>Số điện thoại:</label>
                    <span id="detailPhone" class="value-text"></span>
                </div>
                <div class="detail-item">
                    <label>Email:</label>
                    <span id="detailEmail" class="value-text link-text"></span>
                </div>
                <div class="detail-item">
                    <label>Tên sự kiện:</label>
                    <span id="detailCode" class="value-text" style="font-weight:bold; color:#007bff;"></span>
                </div>
                <div class="detail-item">
                    <label>Loại hình:</label>
                    <span id="detailType" class="value-text"></span>
                </div>

                <div class="detail-item" id="rowRequestedPlace">
                    <label>Địa điểm mong muốn:</label>
                    <span id="detailRequestedPlace" class="value-text"></span>
                </div>

                <div class="detail-item" id="rowAssignedRoom" style="display: none;">
                    <label>Phòng tổ chức:</label>
                    <span id="detailAssignedRoom" class="value-text" style="color: green; font-weight: bold;"></span>
                </div>
            </div>

            <div class="detail-full-row">
                <label>Thời gian thuê:</label>
                <div class="time-box">
                    Từ: <strong id="detailFrom"></strong> <i class="fas fa-arrow-right"></i> Đến: <strong id="detailTo"></strong>
                </div>
            </div>

            <div class="detail-full-row" id="rowFee" style="display: none;">
                <label>Phí sử dụng:</label>
                <span id="detailFee" class="value-text" style="font-size: 1.1em; color: #d9534f; font-weight: bold;"></span>
            </div>

            <div class="detail-full-row">
                <label>Lý do / Nội dung chi tiết:</label>
                <div id="detailReason" class="reason-box"></div>
            </div>

            <div class="modal-footer-actions" id="detailActions">
                <button id="btnReject" class="btn-reject" onclick="triggerRejectFromDetail()">
                    <i class="fas fa-times"></i> Từ chối
                </button>
                <button id="btnApprove" class="btn-approve" onclick="triggerApproveFromDetail()">
                    <i class="fas fa-check"></i> Duyệt đơn
                </button>
            </div>
        </div>
    </div>
</div>

<div id="approveModal" class="modal-overlay" style="z-index: 1100;">
    <div class="modal-content small-modal">
        <div class="modal-header">
            <h3>Xác nhận Duyệt</h3>
            <span class="close-btn" onclick="closeModal('approveModal')">&times;</span>
        </div>
        <div class="modal-body">
            <p>Duyệt đơn của: <strong id="approveName"></strong></p>
            <div class="form-group">
                <label>Phí sử dụng (VNĐ):</label>
                <input type="number" id="feeInput" class="form-control" value="0">
            </div>
            <div class="form-group">
                <label>Phân công phòng <span class="text-danger">*</span>:</label>
                <select id="roomSelect" class="form-control">
                    <option value="" disabled selected>-- Chọn phòng sử dụng --</option>
                    <option value="1">Hội Trường Lớn (300 chỗ)</option>
                    <option value="2">Phòng Sinh Hoạt Cộng Đồng (100 chỗ)</option>
                    <option value="3">Phòng Đa Năng (50 chỗ)</option>
                    <option value="4">Sân sinh hoạt chung</option>
                </select>
                <small class="hint-text">Vui lòng kiểm tra lịch trống trước khi chọn.</small>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('approveModal')">Hủy</button>
                <button class="btn-primary" onclick="confirmApprove()">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<div id="rejectModal" class="modal-overlay" style="z-index: 1100;">
    <div class="modal-content small-modal">
        <div class="modal-header">
            <h3>Từ chối Yêu cầu</h3>
            <span class="close-btn" onclick="closeModal('rejectModal')">&times;</span>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Lý do từ chối:</label>
                <textarea id="rejectReason" class="form-control" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('rejectModal')">Hủy</button>
                <button class="btn-danger" onclick="confirmReject()">Từ chối</button>
            </div>
        </div>
    </div>
</div>